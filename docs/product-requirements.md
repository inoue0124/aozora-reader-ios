# プロダクト要求定義書（PRD）: 青空文庫リーダー v2

## 1. プロダクト概要

- **目的**: 青空文庫作品を「発見→没入→振り返り」の体験で届ける iOS リーダー
- **コンセプト**: 「作品を探すアプリ」ではなく「今日読みたい1冊に自然に出会えるアプリ」
- **ターゲット**: 通勤・就寝前に読書するユーザー、日本文学に興味がある読者
- **プラットフォーム**: iOS 17+ / SwiftUI + MVVM / SwiftData

### 解決したい課題

- モバイルで青空文庫を読む導線が分かりにくい
- 検索起点では「知っている作品」にしかたどり着けない
- 作品の魅力（あらすじ・レビュー）が伝わらず、読み始めるハードルが高い
- 読書→レビュー→次の作品発見、という回遊が生まれにくい

## 2. ユーザーストーリー

### Must（MVP）

1. ホーム画面で棚（レール UI）を回遊し、気になる作品に出会いたい
2. 作品タイプ別の棚（短編 / 長編 / エッセイ / 戯曲 / 児童文学 / 詩）で興味のあるジャンルを探したい
3. おすすめ著者棚で、自分のレビュー・閲覧履歴に基づいた著者に出会いたい
4. 最近のレビュー棚で、直近に評価した作品を振り返りたい
5. 続きから読むカードで、中断した読書をワンタップで再開したい
6. 作品詳細であらすじを読み、読む判断をしたい
7. 縦書き・ページめくりで作品を読みたい（デフォルト）
8. タイトル / 著者名で作品を検索したい
9. 作品にレビュー（星 + コメント）を残したい
10. お気に入り登録 / 解除したい
11. 読書位置を保存して再開したい

### Should

1. 横書きスクロールに切り替えて読みたい
2. フォントサイズ / 行間 / 余白 / テーマを調整したい
3. ルビを読みやすく表示したい
4. 著者プロフィール（顔画像・作品一覧）を見たい
5. 著作権・出典情報を確認したい

### Could（次フェーズ）

1. オフライン保存の管理 UI
2. 棚のパーソナライズ（並び順変更）
3. レビュー共有（サーバー同期）
4. iPad / macOS 対応

## 3. 画面フロー

```
ホーム（発見画面）
├── おすすめ著者棚 → 著者詳細画面 → 作品詳細画面
├── 最近のレビュー棚 → 作品詳細画面
├── 作品タイプ別棚 → 作品詳細画面
├── 続きから読むカード → 読書画面
└── 新着作品棚 → 作品詳細画面

作品詳細画面
├── 読書画面（縦書きページめくり / 横書きスクロール）
├── レビュー投稿シート
└── 著者詳細画面

検索画面（タブ）
└── 作品詳細画面

お気に入り一覧画面（タブ）
└── 作品詳細画面
```

## 4. 機能要件（MVP）

### FR-001 ホーム（発見画面）

- 横スクロールのレール UI（棚）を縦に並べる構成
- 棚の種類:
  - **おすすめ著者**: レビュー・閲覧履歴に基づくスコアリングで選定（履歴なし時はフォールバック表示）
  - **最近のレビュー**: 直近にレビューした作品を時系列で表示
  - **作品タイプ別**: 短編 / 長編 / エッセイ / 戯曲 / 児童文学 / 詩
  - **続きから読む**: しおりのある作品カード
  - **新着作品**: カタログ更新日順

### FR-002 おすすめ著者（レビュー・閲覧履歴ベース）

- ユーザーの閲覧履歴（ReadingHistory）とレビュー（BookReview）をソースとする
- スコアリングロジック:
  - レビュー済み著者の他作品 → 高スコア
  - 閲覧回数が多い著者 → 中スコア
  - 同分類（作品タイプ）の著者 → 低スコア
- 履歴が少ない場合（コールドスタート）: カタログ内作品数上位の著者をフォールバック表示
- 表示: 著者名 + 代表作タイトル + 著者画像（Wikipedia API）

### FR-003 作品詳細

- タイトル・著者・分類・出典を表示
- **あらすじ**: バンドル JSON（固定データ）を第一ソースとし、未収録作品は LLM で生成補完
- 表紙画像（カラープレースホルダー / 将来 AI 生成）
- レビュー一覧表示
- お気に入り操作
- 「読む」導線

### FR-004 あらすじデータ

- **固定 JSON**: `summaries.json` としてバンドル。主要作品のあらすじを事前収録
- **生成補完**: 固定 JSON に該当がない場合、本文冒頭から LLM API で生成しキャッシュ
- 生成結果はローカルキャッシュ（SwiftData）に保存し、再生成を抑制
- オフライン時は「あらすじなし」表示にフォールバック

### FR-005 作品タイプ分類

- カタログの `classification` フィールドをベースに分類
- 分類カテゴリ: 短編 / 長編 / エッセイ / 戯曲 / **児童文学** / **詩** / その他
- 分類マッピングルールはアプリ内定数で管理

### FR-006 本文表示

- 縦書き・ページめくりがデフォルト
- 横書き・スクロールは設定で切替
- ページ位置表示（現在 / 総ページ）
- 読書設定（フォントサイズ / 行間 / 余白 / テーマ）
- ルビ・注記の整形

### FR-007 閲覧履歴

- 作品を開いた時点で ReadingHistory レコードを作成 / 更新
- 記録項目: bookId, authorPersonId, classification, lastViewedAt, viewCount
- おすすめ著者ロジックへのインプットとして使用

### FR-008 しおり

- 読書位置の自動保存
- 再度開いたとき同位置から再開
- ホームの「続きから読む」カードに反映

### FR-009 お気に入り

- 追加 / 削除
- 一覧表示（タブ）

### FR-010 レビュー

- 星評価（1〜5）+ コメント
- 作品詳細画面でレビュー表示
- ホームの「最近のレビュー」棚に反映
- おすすめ著者ロジックへのインプットとして使用

### FR-011 検索

- タイトル / 著者で検索
- 結果一覧表示
- 0 件時の空状態表示

## 5. 非機能要件

- 起動体感が遅くないこと（ホーム棚は即表示、データはバックグラウンドロード）
- 読書画面でページめくりが滑らかであること
- オフライン時に明確なエラーメッセージを出す
- 通信は HTTPS のみ
- SwiftData の保存は非同期・バックグラウンドで行う
- カタログ検索は 17,000 件でも体感遅延なし

## 6. 外部依存

| 依存先 | 用途 | 備考 |
|--------|------|------|
| 青空文庫サーバー | 本文 HTML/テキスト取得 | `www.aozora.gr.jp` |
| バンドル JSON | カタログ + あらすじ | `aozora_catalog.json`, `summaries.json` |
| Wikipedia REST API | 著者画像取得 | `ja.wikipedia.org/api/rest_v1/` |
| LLM API（将来） | あらすじ生成補完 | API キー設定後に有効化 |

## 7. 受け入れ条件

1. ホーム画面に棚が表示され、横スクロールで作品を回遊できる
2. おすすめ著者棚がレビュー・閲覧履歴に基づいて表示される
3. 履歴なし時にフォールバック著者が表示される
4. 作品タイプ棚に短編 / 長編 / エッセイ / 戯曲 / 児童文学 / 詩 が含まれる
5. 作品詳細であらすじが表示される（固定 JSON or 生成補完）
6. 縦書きページめくりで読書できる
7. レビューを投稿するとおすすめ著者に反映される
8. 閲覧履歴が記録され、おすすめ著者に反映される
9. しおり保存 / 再開ができる
10. お気に入り登録 / 解除ができる

## 8. スコープ外（MVP）

- アカウント同期
- iPad / macOS 対応
- 課金 / 広告
- SNS 共有
- 多言語対応
- 棚のパーソナライズ（並び順変更）
- レビュー共有（サーバー同期）
